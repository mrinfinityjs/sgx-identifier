Of course. Here is a complete `README.md` file that you can copy and paste directly into your GitHub repository. It explains what the script does, how to use it, and most importantly, details what is required from Intel's ecosystem to make it production-ready.

---

# Simple SGX Quote Verifier (Node.js)

This repository contains a simple, dependency-free Node.js script (`verify.js`) for verifying an Intel速 SGX quote. Its primary purpose is to demonstrate the application-level logic of SGX attestation: parsing a quote and checking its measurements (`MRENCLAVE` and `MRSIGNER`) against expected values.

This script is an excellent tool for understanding the workflow of remote attestation and for integrating the final verification step into a Node.js backend.

**IMPORTANT:** The full cryptographic verification of the quote's signature and trust chain against Intel's root of trust is currently **simulated**. To make this script production-ready, you must integrate it with Intel's official DCAP (Data Center Attestation Primitives) libraries. See the "Making it Production-Ready" section below for details.

## Features

-   **Zero npm Dependencies:** The script uses only built-in Node.js modules. No `npm install` is needed.
-   **Parses Key Quote Fields:** Manually parses `MRENCLAVE`, `MRSIGNER`, and `REPORT_DATA` from the raw quote binary.
-   **Flexible CLI:** Accepts all necessary inputs (quote, expected measurements) as command-line arguments.
-   **Clear Separation of Concerns:** The application logic (checking `MRENCLAVE`) is separate from the complex cryptographic logic (which is simulated), making it easy to replace the simulation with a real implementation.

## Prerequisites

-   **Node.js** (v18.x or later is recommended to ensure the built-in `util.parseArgs` is available).

## Usage

The script is launched from the command line, providing three required arguments:

-   `--quote`: The Base64-encoded SGX quote from the server.
-   `--expected_mrenclave_hex`: The expected `MRENCLAVE` measurement in hexadecimal format. This hash identifies the exact code and initial data of the enclave you trust.
-   `--expected_mrsigner_hex`: The expected `MRSIGNER` measurement in hexadecimal format. This hash identifies the author/signer of the enclave you trust.

### Command Syntax

```sh
node verify.js --quote <base64_quote> --expected_mrenclave_hex <hex_string> --expected_mrsigner_hex <hex_string>
```

### Example

Here is a full example using a sample quote and its corresponding measurements.

```bash
node verify.js \
--quote "AAMFAAYEAAIAAAAEAAgAAQAAAAAAAAsAqAAAAAAACgAAAAAAAAAFAAEAAAAGAAAAAAAAACAAAAAAAACAAUAAAAAAAAAAAAAAAAB4AQAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHsCIl7X7qwaavavpadrQwPIrZtpAg+ccO4d/AjHzl0AALfR0bFpuvf9+YgG8q6YGLf6zUq2Uj2yM2QzTqjjdSAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAxlN1ks4JY1F0OE5Zwrlyg/mKL9SM8crz7HPeD44dw1AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADp0FfF154s5qO0tG2/LzQbaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDByt0m6Hq4i8w7d1iQ88/F+UfO3C9LAAACzczf+yQWl/4eD8b4f4+AIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwEAAQAEAAUAAgQFAAQAAgAAACgAAMfR0bFpuvf9+YgG8q6YGLf6zUq2Uj2yM2QzTqjjdSA=" \
--expected_mrenclave_hex "c1a539a2ce09635174384e59c2b97c83f98a28f5223c72bcfb1cf6c3e38770d4" \
--expected_mrsigner_hex "83d719e77deaca1470f6baf62a4d774303c899db69020f9c70ee1dfc08c7ce5d"
```

### Output on Success

```
--- [SIMULATION] Performing Full Cryptographic Verification ---
INFO: In a production system, this step uses Intel's DCAP libraries to verify the quote's signature and trust chain against the PCCS.
INFO: Simulation result: SUCCESS
------------------------------------------------------------

[+] Cryptographic verification of the quote was successful.

--- Enclave Details from Quote ---
MRENCLAVE:   c1a539a2ce09635174384e59c2b97c83f98a28f5223c72bcfb1cf6c3e38770d4
MRSIGNER:    83d719e77deaca1470f6baf62a4d774303c899db69020f9c70ee1dfc08c7ce5d
...
----------------------------------

--- Comparing with Expected Values ---
MRENCLAVE matches expected value: YES
MRSIGNER matches expected value:  YES
------------------------------------

[SUCCESS] The enclave has been successfully verified. It is the correct software from the correct publisher.
```

---

## Making it Production-Ready: Intel速 SGX DCAP Integration

The function `performFullCryptographicVerification` in `verify.js` is a placeholder. A real verifier **must** cryptographically verify the quote's signature and the entire trust chain. This process ensures the quote was generated by genuine Intel hardware with an up-to-date security patch level.

To do this, you need to use components from **Intel's SGX Data Center Attestation Primitives (DCAP)**.

### What You Need from Intel's API and Ecosystem

1.  **Intel速 SGX DCAP Quote Verification Library (QVL)**
    -   **What it is:** A C/C++ library provided by Intel that contains the core logic for verifying quote signatures, parsing certificates, and checking TCB levels.
    -   **How you use it:** This is the engine that performs the actual verification. Your Node.js application needs to be able to call the functions within this native library.

2.  **Intel速 Provisioning Certificate Caching Service (PCCS)**
    -   **What it is:** A local or remote web service that caches the necessary "attestation collateral" from Intel's public servers. A quote cannot be verified without this collateral.
    -   **How you use it:** The QVL, during verification, will make network requests to the PCCS to fetch the collateral associated with the quote. You must either use Intel's hosted PCCS or run your own instance.

3.  **The Attestation Collateral (fetched from PCCS)**
    -   This is the data required by the QVL to perform its checks. It includes:
        -   **PCK Certificate Chain:** A certificate chain for the specific processor that created the quote, which chains back to an Intel Root CA. This proves the hardware is genuine.
        -   **TCB (Trusted Computing Base) Info:** A signed statement from Intel declaring the security patch level (microcode, etc.) of the CPU that generated the quote. This proves the hardware is not known to be vulnerable.
        -   **Certificate Revocation Lists (CRLs):** Lists of revoked certificates to ensure that no part of the trust chain has been compromised.

### Recommended Production Architectures

Because the QVL is a native C++ library, you cannot use it directly in a standard Node.js application. Here are the recommended patterns for integration:

1.  **Microservice (Recommended):** Create a small, separate microservice in C++ or Rust that links against the QVL. Your Node.js `verify.js` script would then make an HTTP request to this internal service, passing the quote and receiving a simple "verified" or "not verified" response. This is the cleanest and most robust approach.

2.  **Node.js Native Addon:** Write a C++ addon for Node.js. This addon would link against the QVL and expose the verification function to your JavaScript code. This is a high-performance solution but requires expertise in C++ and the Node.js N-API.

3.  **Child Process (Shell Out):** The Intel SGX SDK includes a sample C++ command-line tool for quote verification. You could modify `verify.js` to call this compiled binary as a child process, passing the quote data and parsing the `stdout` for the result. This is simpler to implement but can be less robust than the other options.

## License

[MIT](LICENSE)
